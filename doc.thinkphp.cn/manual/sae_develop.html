<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>SAE开发 - ThinkPHP完全开发手册 - 3.1</title><meta name="keywords" content="ThinkPHP,文档中心,在线手册,phpthink,类库参考,视频教程,book,3.0,api,开发框架,web框架,PHP开发框架,ThinkPHP手册"/><meta name="description" content="中文最佳实践框架  JUST THINK IT ThinkPHP 大道至简 开发由我|php快速开发|just think it|php开源框架|php网站开发|上海顶想|ORM|Framework|PHP企业开发"/><link href="../Public/favicon.ico" rel="shortcut icon"><link rel="stylesheet" type="text/css" href="../Public/css/layout.css" /><link rel="stylesheet" type="text/css" href="../Public/css/book.css" /><link rel="stylesheet" type="text/css" href="../Public/prettify/prettify.css" /><link rel="stylesheet" type="text/css" href="../Public/ThinkBox/ThinkBox.css" /><script type="text/javascript" src="../Public/js/jquery-1.7.1.min.js"></script><script type="text/javascript" src="../Public/js/common.js"></script><script type="text/javascript" src="../Public/prettify/prettify.js"></script><script type="text/javascript" src="../Public/ThinkBox/jquery.ThinkBox.js"></script><link rel="stylesheet" type="text/css" href="../Plugin/remark/remark.css" /><script type="text/javascript" src="../Plugin/remark/remark.js"></script></head><body><div id="header"><div id="innerHeader"><div class="book-top cf"><div class="book-logo fl"><a href="../manual.html" book="1">ThinkPHP完全开发手册</a><sup>3.1</sup></div><div class="right fr"><div class="user-current"></div></div></div></div></div><div id="sortList"><div class="inner"><div class="menu-title">目录Directory</div></div></div><div id="selector"><div class="inner"><div class="book-menu"><div class="list"><ul><li class=" child"><a class="title " href="preface.html" title="序言">序言</a></li><li class=" child"><a class="title " href="start.html" title="入门">第1章&nbsp;入门</a><ul><li><a class="" href="introduction.html">1.1&nbsp;简介</a></li><li><a class="" href="basic_concept.html">1.2&nbsp;基础概念</a></li><li><a class="" href="get_thinkphp.html">1.3&nbsp;获取ThinkPHP</a></li><li><a class="" href="environment.html">1.4&nbsp;环境要求</a></li><li><a class="" href="licence.html">1.5&nbsp;许可协议</a></li><li><a class="" href="directory.html">1.6&nbsp;目录结构</a></li><li><a class="" href="naming_conventions.html">1.7&nbsp;命名规范</a></li><li><a class="" href="mvc.html">1.8&nbsp;MVC分层</a></li><li><a class="" href="cbd.html">1.9&nbsp;CBD架构</a></li><li><a class="" href="features.html">1.10&nbsp;特性概述</a></li><li><a class="" href="system_process.html">1.11&nbsp;系统流程</a></li><li><a class="" href="development_process.html">1.12&nbsp;开发流程</a></li></ul></li><li class=" child"><a class="title " href="entry.html" title="入口">第2章&nbsp;入口</a><ul><li><a class="" href="entrance.html">2.1&nbsp;入口文件</a></li><li><a class="" href="app_directory.html">2.2&nbsp;项目目录</a></li><li><a class="" href="deploy_directory.html">2.3&nbsp;部署目录</a></li><li><a class="" href="app_compile.html">2.4&nbsp;项目编译</a></li><li><a class="" href="debug_mode.html">2.5&nbsp;调试模式</a></li></ul></li><li class=" child"><a class="title " href="config.html" title="配置">第3章&nbsp;配置</a><ul><li><a class="" href="config_type.html">3.1&nbsp;配置格式</a></li><li><a class="" href="convention_config.html">3.2&nbsp;惯例配置</a></li><li><a class="" href="app_config.html">3.3&nbsp;项目配置</a></li><li><a class="" href="debug_config.html">3.4&nbsp;调试配置</a></li><li><a class="" href="group_config.html">3.5&nbsp;分组配置</a></li><li><a class="" href="read_config.html">3.6&nbsp;读取配置</a></li><li><a class="" href="dynamic_config.html">3.7&nbsp;动态配置</a></li><li><a class="" href="extend_config.html">3.8&nbsp;扩展配置</a></li></ul></li><li class=" child"><a class="title " href="function_class.html" title="函数和类库">第4章&nbsp;函数和类库</a><ul><li><a class="" href="functions.html">4.1&nbsp;函数库</a></li><li><a class="" href="class.html">4.2&nbsp;类库</a></li></ul></li><li class=" child"><a class="title " href="controller.html" title="控制器">第5章&nbsp;控制器</a><ul><li><a class="" href="url_mode.html">5.1&nbsp;URL模式</a></li><li><a class="" href="module_action.html">5.2&nbsp;模块和操作</a></li><li><a class="" href="define_controller.html">5.3&nbsp;定义控制器</a></li><li><a class="" href="empty_action.html">5.4&nbsp;空操作</a></li><li><a class="" href="empty_module.html">5.5&nbsp;空模块</a></li><li><a class="" href="module_group.html">5.6&nbsp;模块分组</a></li><li><a class="" href="url_suffix.html">5.7&nbsp;URL伪静态</a></li><li><a class="" href="url_route.html">5.8&nbsp;URL路由</a></li><li><a class="" href="url_rewrite.html">5.9&nbsp;URL重写</a></li><li><a class="" href="url_build.html">5.10&nbsp;URL生成</a></li><li><a class="" href="url_case.html">5.11&nbsp;URL大小写</a></li><li><a class="" href="before_after.html">5.12&nbsp;前置和后置操作</a></li><li><a class="" href="cross_module.html">5.13&nbsp;跨模块调用</a></li><li><a class="" href="page_dispatch.html">5.14&nbsp;页面跳转</a></li><li><a class="" href="redirect.html">5.15&nbsp;重定向</a></li><li><a class="" href="get_system_var.html">5.16&nbsp;获取系统变量</a></li><li><a class="" href="request_method.html">5.17&nbsp;判断请求类型</a></li><li><a class="" href="get_url_params.html">5.18&nbsp;获取URL参数</a></li><li><a class="" href="ajax_return.html">5.19&nbsp;AJAX返回</a></li><li><a class="" href="action_param_bind.html">5.20&nbsp;Action参数绑定</a></li><li><a class="" href="multi_action_layer.html">5.21&nbsp;多层控制器支持</a></li></ul></li><li class=" child"><a class="title " href="model.html" title="模型">第6章&nbsp;模型</a><ul><li><a class="" href="model_define.html">6.1&nbsp;模型定义</a></li><li><a class="" href="model_instance.html">6.2&nbsp;模型实例化</a></li><li><a class="" href="field_define.html">6.3&nbsp;字段定义</a></li><li><a class="" href="primary_key.html">6.4&nbsp;数据主键</a></li><li><a class="" href="get_fields.html">6.5&nbsp;属性访问</a></li><li><a class="" href="cross_database.html">6.6&nbsp;跨库操作</a></li><li><a class="" href="connect_database.html">6.7&nbsp;连接数据库</a></li><li><a class="" href="switch_database.html">6.8&nbsp;切换数据库</a></li><li><a class="" href="distributed_database.html">6.9&nbsp;分布式数据库</a></li><li><a class="" href="create.html">6.10&nbsp;创建数据</a></li><li><a class="" href="field_map.html">6.11&nbsp;字段映射</a></li><li><a class="" href="continuous_operation.html">6.12&nbsp;连贯操作</a></li><li><a class="" href="curd.html">6.13&nbsp;CURD操作</a></li><li><a class="" href="active_record.html">6.14&nbsp;ActiveRecord</a></li><li><a class="" href="auto_validate.html">6.15&nbsp;自动验证</a></li><li><a class="" href="name_range.html">6.16&nbsp;命名范围</a></li><li><a class="" href="auto_operate.html">6.17&nbsp;自动完成</a></li><li><a class="" href="query.html">6.18&nbsp;查询语言</a></li><li><a class="" href="query_lock.html">6.19&nbsp;查询锁定</a></li><li><a class="" href="field_except.html">6.20&nbsp;字段排除</a></li><li><a class="" href="trans_support.html">6.21&nbsp;事务支持</a></li><li><a class="" href="adv_model.html">6.22&nbsp;高级模型</a></li><li><a class="" href="view_model.html">6.23&nbsp;视图模型</a></li><li><a class="" href="relation_model.html">6.24&nbsp;关联模型</a></li><li><a class="" href="mongo_model.html">6.25&nbsp;Mongo模型</a></li><li><a class="" href="dynamic_model.html">6.26&nbsp;动态模型</a></li><li><a class="" href="virtual_model.html">6.27&nbsp;虚拟模型</a></li><li><a class="" href="multi_model_layer.html">6.28&nbsp;多层模型支持</a></li></ul></li><li class=" child"><a class="title " href="view.html" title="视图">第7章&nbsp;视图</a><ul><li><a class="" href="template_define.html">7.1&nbsp;模板定义</a></li><li><a class="" href="template_assign.html">7.2&nbsp;模板赋值</a></li><li><a class="" href="template_output.html">7.3&nbsp;模板输出</a></li><li><a class="" href="template_replace.html">7.4&nbsp;模板替换</a></li><li><a class="" href="fetch_content.html">7.5&nbsp;获取内容</a></li><li><a class="" href="template_engine.html">7.6&nbsp;模板引擎</a></li><li><a class="" href="layout.html">7.7&nbsp;布局模板</a></li></ul></li><li class=" child"><a class="title " href="template.html" title="模板引擎">第8章&nbsp;模板引擎</a><ul><li><a class="" href="var_output.html">8.1&nbsp;变量输出</a></li><li><a class="" href="system_var.html">8.2&nbsp;系统变量</a></li><li><a class="" href="use_function.html">8.3&nbsp;使用函数</a></li><li><a class="" href="default_val.html">8.4&nbsp;默认值输出</a></li><li><a class="" href="use_operate.html">8.5&nbsp;使用运算符</a></li><li><a class="" href="buildin_tag.html">8.6&nbsp;内置标签</a></li><li><a class="" href="include_file.html">8.7&nbsp;包含文件</a></li><li><a class="" href="load_file.html">8.8&nbsp;导入文件</a></li><li><a class="" href="volist.html">8.9&nbsp;Volist标签</a></li><li><a class="" href="foreach.html">8.10&nbsp;Foreach标签</a></li><li><a class="" href="for.html">8.11&nbsp;For标签</a></li><li><a class="" href="switch.html">8.12&nbsp;Switch标签</a></li><li><a class="" href="compare.html">8.13&nbsp;比较标签</a></li><li><a class="" href="three_operators.html">8.14&nbsp;三元运算</a></li><li><a class="" href="range.html">8.15&nbsp;范围判断标签</a></li><li><a class="" href="present.html">8.16&nbsp;Present标签</a></li><li><a class="" href="empty.html">8.17&nbsp;Empty标签</a></li><li><a class="" href="defined.html">8.18&nbsp;Defined标签</a></li><li><a class="" href="define.html">8.19&nbsp;Define标签</a></li><li><a class="" href="assign.html">8.20&nbsp;Assign标签</a></li><li><a class="" href="if.html">8.21&nbsp;IF标签</a></li><li><a class="" href="tag_nest.html">8.22&nbsp;标签嵌套</a></li><li><a class="" href="use_php.html">8.23&nbsp;使用PHP代码</a></li><li><a class="" href="layout_template.html">8.24&nbsp;模板布局</a></li><li><a class="" href="extend_template.html">8.25&nbsp;模板继承</a></li><li><a class="" href="literal.html">8.26&nbsp;原样输出</a></li><li><a class="" href="comment.html">8.27&nbsp;模板注释</a></li><li><a class="" href="taglib.html">8.28&nbsp;引入标签库</a></li><li><a class="" href="modify_edlim.html">8.29&nbsp;修改定界符</a></li><li><a class="" href="js_confusion.html">8.30&nbsp;避免JS混淆</a></li></ul></li><li class=" child"><a class="title " href="log.html" title="日志">第9章&nbsp;日志</a><ul><li><a class="" href="log_level.html">9.1&nbsp;日志级别</a></li><li><a class="" href="log_type.html">9.2&nbsp;记录方式</a></li><li><a class="" href="log_record.html">9.3&nbsp;手动记录</a></li></ul></li><li class=" child"><a class="title " href="error.html" title="错误">第10章&nbsp;错误</a><ul><li><a class="" href="exception.html">10.1&nbsp;异常处理</a></li><li><a class="" href="exception_tmpl.html">10.2&nbsp;异常模板</a></li><li><a class="" href="exception_info.html">10.3&nbsp;异常显示</a></li></ul></li><li class=" child"><a class="title " href="debug.html" title="调试">第11章&nbsp;调试</a><ul><li><a class="" href="app_status.html">11.1&nbsp;运行状态</a></li><li><a class="" href="page_trace.html">11.2&nbsp;页面Trace</a></li><li><a class="" href="debug_mothod.html">11.3&nbsp;调试方法</a></li></ul></li><li class=" child"><a class="title " href="cache.html" title="缓存">第12章&nbsp;缓存</a><ul><li><a class="" href="cache_type.html">12.1&nbsp;缓存方式</a></li><li><a class="" href="dynamic_cache.html">12.2&nbsp;动态缓存</a></li><li><a class="" href="cache_queue.html">12.3&nbsp;缓存队列</a></li><li><a class="" href="express_cache.html">12.4&nbsp;快捷缓存</a></li><li><a class="" href="fast_save.html">12.5&nbsp;快速缓存</a></li><li><a class="" href="query_cache.html">12.6&nbsp;查询缓存</a></li><li><a class="" href="sql_cache.html">12.7&nbsp;SQL解析缓存</a></li><li><a class="" href="html_cache.html">12.8&nbsp;静态缓存</a></li></ul></li><li class=" child"><a class="title " href="extend.html" title="扩展">第13章&nbsp;扩展</a><ul><li><a class="" href="behavior_extend.html">13.1&nbsp;行为扩展</a></li><li><a class="" href="library_extend.html">13.2&nbsp;类库扩展</a></li><li><a class="" href="action_extend.html">13.3&nbsp;控制器扩展</a></li><li><a class="" href="model_extend.html">13.4&nbsp;模型扩展</a></li><li><a class="" href="driver_extend.html">13.5&nbsp;驱动扩展</a></li><li><a class="" href="widget_extend.html">13.6&nbsp;Widget扩展</a></li><li><a class="" href="mode_extend.html">13.7&nbsp;模式扩展</a></li><li><a class="" href="engine_extend.html">13.8&nbsp;引擎扩展</a></li></ul></li><li class=" child"><a class="title " href="safety.html" title="安全">第14章&nbsp;安全</a><ul><li><a class="" href="form_token.html">14.1&nbsp;表单令牌</a></li><li><a class="" href="field_type_validate.html">14.2&nbsp;字段类型验证</a></li><li><a class="" href="sql_injection.html">14.3&nbsp;防止SQL注入</a></li><li><a class="" href="input_filter.html">14.4&nbsp;输入过滤</a></li><li><a class="" href="upload_safe.html">14.5&nbsp;上传安全</a></li><li><a class="" href="prevent_xss.html">14.6&nbsp;防止XSS攻击</a></li><li><a class="" href="other_suggestion.html">14.7&nbsp;其他安全建议</a></li><li><a class="" href="dir_secure.html">14.8&nbsp;目录安全文件</a></li><li><a class="" href="protected_template.html">14.9&nbsp;保护模板文件</a></li></ul></li><li class=" child"><a class="title " href="performance.html" title="性能">第15章&nbsp;性能</a><ul><li><a class="" href="close_debug.html">15.1&nbsp;关闭调试模式</a></li><li><a class="" href="cache_on.html">15.2&nbsp;开启缓存</a></li><li><a class="" href="merge_fields.html">15.3&nbsp;合并字段缓存</a></li><li><a class="" href="sql_optimization.html">15.4&nbsp;优化SQL</a></li><li><a class="" href="replace_entrance.html">15.5&nbsp;替换入口</a></li><li><a class="" href="front_optimization.html">15.6&nbsp;前端优化</a></li></ul></li><li class=" child"><a class="title " href="deploy.html" title="部署">第16章&nbsp;部署</a><ul><li><a class="" href="path_info_support.html">16.1&nbsp;PATH_INFO支持</a></li><li><a class="" href="hidden_index.html">16.2&nbsp;隐藏index.php</a></li><li><a class="" href="sub_domain_deploy.html">16.3&nbsp;二级域名部署</a></li><li><a class="" href="error_page.html">16.4&nbsp;定制错误页面</a></li><li><a class="" href="set_zone.html">16.5&nbsp;设置时区</a></li></ul></li><li class="show child"><a class="title " href="sae.html" title="SAE支持">第17章&nbsp;SAE支持</a><ul><li><a class="" href="sae_intro.html">17.1&nbsp;SAE介绍</a></li><li><a class="" href="get_sae.html">17.2&nbsp;获取SAE</a></li><li><a class="selected" href="sae_develop.html">17.3&nbsp;SAE开发</a></li></ul></li><li class=" child"><a class="title " href="rest.html" title="REST支持">第18章&nbsp;REST支持</a><ul><li><a class="" href="rest_intro.html">18.1&nbsp;REST介绍</a></li><li><a class="" href="rest_mode.html">18.2&nbsp;REST模式</a></li><li><a class="" href="rest_config.html">18.3&nbsp;REST配置</a></li><li><a class="" href="rest_route.html">18.4&nbsp;REST路由</a></li><li><a class="" href="rest_method.html">18.5&nbsp;REST方法</a></li></ul></li><li class=" child"><a class="title " href="sundry.html" title="杂项">第19章&nbsp;杂项</a><ul><li><a class="" href="session.html">19.1&nbsp;Session支持</a></li><li><a class="" href="cookie.html">19.2&nbsp;Cookie支持</a></li><li><a class="" href="date.html">19.3&nbsp;日期和时间</a></li><li><a class="" href="wml.html">19.4&nbsp;WML开发</a></li><li><a class="" href="multi_lang.html">19.5&nbsp;多语言</a></li><li><a class="" href="data_page.html">19.6&nbsp;数据分页</a></li><li><a class="" href="upload.html">19.7&nbsp;文件上传</a></li><li><a class="" href="verify.html">19.8&nbsp;验证码</a></li><li><a class="" href="watermark.html">19.9&nbsp;图片添加水印</a></li><li><a class="" href="ip_location.html">19.10&nbsp;IP获取和定位</a></li></ul></li><li class=" child"><a class="title " href="appendix.html" title="附录">第20章&nbsp;附录</a><ul><li><a class="" href="constant_reference.html">20.1&nbsp;常量参考</a></li><li><a class="" href="config_reference.html">20.2&nbsp;配置参考</a></li><li><a class="" href="version_update.html">20.3&nbsp;关于升级</a></li><li><a class="" href="memorabilia.html">20.4&nbsp;大事记</a></li></ul></li><li class=" child"><a class="title " href="thanks.html" title="鸣谢">第21章&nbsp;鸣谢</a></li></ul></div></div></div></div><div id="tools"><div class="inner"><div class="book-tool"><div class="content cf"><div class="search fl"><form action="/manual/_search.html" method="post" class="cf"><label for="search-key">输入搜索关键字...</label><input id="search-key" class="text fl" type="text" name="keywords" /><input class="button fl" type="submit" value="&nbsp;" title="搜索" /></form></div><a class="next fr" href="javascript:void(0)" title="下一章"><i>&nbsp;</i></a><a class="prev fr" href="javascript:void(0)" title="上一章"><i>&nbsp;</i></a><a class="share fr" href="javascript:void(0)" title="分享">分享<i>&nbsp;</i></a></div></div></div></div><div id="gird"><div class="inner"><div class="book-title" menu="173"><h1>17.3&nbsp;SAE开发</h1></div><div id="161" class="book-content">ThinkPHP的SAE开发和标准版本的ThinkPHP基本一样，你无需了解SAE的接口用法，ThinkPHP的SAE引擎已经自动为你整合了SAE的接口，只要掌握ThinkPHP开发，你就能轻松掌握基于ThinkPHP的SAE开发。<br />下面是我们给出的一些利用SAE引擎开发过程的一些注意事项，能够帮助你更好的完成SAE的开发和部署。</div><div id="163" class="book-content"><h3>配置</h3>SAE引擎运行时拥有SAE自己的惯例配置和专有配置，因此配置文件加载顺序为：<br />惯例配置-&gt;项目配置-&gt;SAE惯例配置-&gt;SAE专有配置<br />SAE惯例配置和SAE专有配置中的配置项将会覆盖项目配置。<br /><b>SAE惯例配置</b>：位于 引擎目录/Sae/Conf/convention_sae.php，其中定义了程序在SAE上运行时固定的数据库连接配置项。<br /><b>SAE专有配置</b>：位于项目的Conf目录下，文件名为config_sae.php，大家可以将针对SAE的配置写到其中。<br />注：SAE惯例配置和SAE专有配置是针对SAE环境的独有配置，在本地运行时将不会加载。</div><div id="166" class="book-content"><h3>数据库</h3>开发者不需要在项目配置文件(config.php)中定义和SAE相关的数据库配置项，只需要定义本地调试时连接的数据库即可。代码提交到SAE时无需修改任何配置项也能运行，因为SAE惯例配置会自动覆盖你的项目配置文件中的数据库配置。
  代码在SAE上运行时会进行分布式数据库连接，并读写分离。</div><div id="170" class="book-content"><h3>缓存</h3>在SAE开发过程中，你仍然可以使用ThinkPHP内置的缓存方法进行处理。下面是SAE引擎使用不同的缓存方法在本地和SAE平台下的区别（注意这个区别SAE引擎会自动判断处理）：
<table border="0" cellspacing="1" cellpadding="0">
	<tr>
		<td width="70">缓存方法 </td>
		<td>本地运行 </td>
		<td>SAE平台 </td>
	</tr>
	<tr>
		<td>S缓存 </td>
		<td>默认使用File方式实现 </td>
		<td>固定使用Memcache实现，所以在SAE下 DATA_CACHE_TYPE配置项将失效。你如果需要使用SAE提供的Mecache服务，直接使用S函数就可以 </td>
	</tr>
	<tr>
		<td>F缓存 </td>
		<td>使用File实现 </td>
		<td>使用KVDB实现 </td>
	</tr>
	<tr>
		<td>静态缓存 </td>
		<td>生成静态Html文件 </td>
		<td>静态文件存入KVDB中 </td>
	</tr>
	<tr>
		<td>SQL队列 </td>
		<td>支持File、Xcache和APC方式 </td>
		<td>使用KVDB存储 </td>
	</tr>
</table>
新版的ThinkPHP支持SQL缓存队列功能，我们可以配置DB_SQL_BUILD_CACHE 开启SQL语句解析缓存。在SAE平台下固定使用KVDB存储SQL缓存，因此DB_SQL_BUILD_QUEUE配置项将不起作用。并且在SAE下运行时会用Counter服务记录SQL缓存列队出队次数，在Counter的管理后台<br />http://sae.sina.com.cn/?m=counter 
如果你看到计算器名称为think_queue_out_times 的数值很大，说明你设置的队列个数太小，需要调整DB_SQL_BUILD_LENGTH 配置项。</div><div id="175" class="book-content"><h3>文件上传</h3>文件上传仍然使用UploadFile扩展类库上传文件，使用方法不变。同样的代码在本地运行时将会上传到指定的目录，在SAE上运行时就会自动使用Storage服务，将文件上传到指定的Storage中。首先你需要在SAE平台上创建一个Storage的domain用于存放上传的文件：
<pre class="code" lang="php">http://sae.sina.com.cn/?m=storage</pre>
这里可以建立多个domain。而我们的文件会上传到哪个domain，是由上传路径的第一个目录名称决定的。如：
<pre class="code" lang="php">$upload-&gt;savePath&nbsp;=&nbsp;&nbsp;'./Public/Uploads/';</pre>
会上传到名为Public的domain。你也不用在这个domain下创建Uploads文件夹，SAE的Storage服务会为你自动创建。<br /><b>图片地址的问题</b>：<br />我们使用UploadFile类上传图片，在本地和在SAE下图片的浏览地址是不一样的。比如有张图片地址为  "/Public/upload/1.jpg" ， /Public 是一个模板替换变量， 他会被替换为Public文件夹所在目录的地址， 我们可以通过浏览器的查看源代码功能查看被替换后是什么效果。 可以看见， 替换后为 "/Public/upload/1.jpg" 。 但是在SAE上图片并没有在Public/upload目录下，而是在storage中。 我们需要将 /Public/替换为storage的域名，在SAE上才能正常显示。<br />我们在SAE专有配置Conf/config_sae.php文件中 定义如下代码：
<pre class="code" lang="php">&lt;?php
return&nbsp;array(
&nbsp;&nbsp;&nbsp;&nbsp;'TMPL_PARSE_STRING'=&gt;array(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'/Public/upload'=&gt;sae_storage_root('Public').'/upload'
&nbsp;&nbsp;&nbsp;&nbsp;)
);
</pre>
这样，在SAE上会把 /Public/upload 替换为storage的地址， 在SAE上图片也能正常显示。<br /><b>文件删除问题</b>：<br />因为上传的文件在本地和SAE存放的地方不一样，所以我们不能直接用unlink删除文件。SAE版ThinkPHP新增sae_unlink函数实现兼容。如：
<pre class="code" lang="php">sae_unlink('./Public/Uploads/xxx.jpg');</pre>
在本地运行时，会删除Public/Uploads文件夹下的图片。而在SAE上运行时，会删除domain为Public的Storage中的图片。此函数会删除哪个domian的文件也是由路径的第一个目录名称决定的。</div><div id="176" class="book-content"><h3>图片处理</h3>SAE引擎在图片处理方面也做了自动处理，在本地和SAE平台的区别如下：
<table border="0" cellspacing="1" cellpadding="0">
    <tr>
        <th>图片功能</th>
        <th>本地运行</th>
        <th>SAE平台</th>
    </tr>
    <tr>
        <td>缩略图</td>
        <td>调用Image类库处理</td>
        <td>自动使用SaeImage服务</td>
    </tr>
    <tr>
        <td>验证码</td>
        <td>调用Image类库处理</td>
        <td>自动使用SaeVcode服务</td>
    </tr>
</table>
你完全不用去学习怎么用SaeImage生成缩略图，也不用学习SaeVcode服务怎么用，你还是按照以前的方式使用ThinkPHP进行验证码和缩略图功能就可以了。
<p class="tips">使用验证码的时候需要注意，在本地运行时验证码默认为数字形式，而在SAE上运行时验证码为数字+字母形式，而且存在字母大小写问题。如果你希望验证码区分大小写的话，需要将验证码统一转化为大写后进行匹配。</p> 如:
<pre class="code" lang="php">
if(md5(strtoupper($_POST['verify']))!=$_SESSION['verify']){
&nbsp;&nbsp;&nbsp;&nbsp;//验证错误处理代码
}
</pre></div><div id="177" class="book-content"><h3>日志记录</h3>SAE版ThinkPHP同样实现了生成系统日志功能，在本地运行会将日志记录到项目的项目的Runtime/Logs文件夹下，而在SAE上运行会将日志记录到SAE平台的日志中心：<br />http://sae.sina.com.cn/?m=applog<br />请在搜索框选择中的下拉菜单处选择“debug”进行查看。</div><div id="180" class="book-content"><h3>Trace信息</h3>建议在开发程序时配置SHOW_PAGE_TRACE=&gt;true 开启页面Trace信息。开启后，代码在SAE环境下运行时会显示一些SAE独有的Trace信息，有助于我们开发。你可能会到以下trace信息。<br /><b>模板缓存</b>：Trace信息名称为“[SAE]模板缓存”<br />在SAE下不会将模板编译缓存生成在Runtime目录下，而是存放在Memcache中。如果你想查看模板编译后的缓存，这里显示的就是模板缓存在Memcache中的缓存名称。你可以在SAE的memcache服务管理平台输入缓存名称得到缓存内容：<br />http://sae.sina.com.cn/?m=mcmng<br />注：你看得的缓存内容，都是以一串数字开始，这数字和缓存内容无关，是记录的缓存生成时间。<br /><b>核心缓存</b>：Trace信息名称为“[SAE]核心缓存”<br />它记录的是核心编译缓存在Memcache中的缓存名称。如果你要获得核心编译缓存，比如我们要用核心编译缓存代替入口文件的时候。你可以在SAE的Memcache服务管理平台 输入这里记录的缓存名称获得。<br />注：
<ul><li>在开启调试时不会生成核心编译缓存，如果你获得核心编译缓存，请先关闭调试。</li>
<li>缓存内容开头的数字是记录的缓存生成时间，请将数字去掉后再作为入口文件。</li></ul><br /><b>静态缓存</b>：Trace信息名称为“[SAE]静态缓存”<br />它记录了生成的静态缓存在KVDB中的名称。 目前SAE管理平台没有能直接输入KVDB名称获得内容的地方，大家需要自己写程序获取内容。<br />注：此Trace信息是在生成静态缓存的时候才会出现。如果你访问到的页面没有执行生成静态缓存的操作时，将不会有此条Trace信息。</div><div id="187" class="book-content"><h3>隐藏index.php</h3>SAE不支持.htaccess文件，但我们可以使用SAE提供的AppConfig服务实现伪静态。<br />在你项目的根目录建立config.yaml文件，代码为：
<pre class="code" lang="php">handle:
-&nbsp;rewrite:&nbsp;if(!is_dir()&nbsp;&&&nbsp;!is_file()&nbsp;&&&nbsp;path~"^(.*)$")&nbsp;goto&nbsp;"index.php/$1"</pre>
这样就可以隐藏入口了。<br />比如这样的地址 http://serverName/index.php/Blog/read/id/1也能通过<br />http://serverName/Blog/read/id/1访问。</div><div id="188" class="book-content"><h3>代码横跨性建议</h3>SAE版ThinkPHP，是具有横跨性的，请不要破坏它的横跨性。比如，不要在项目配置文件中写和SAE数据库相关配置项。 自己写代码时，也要尽量做到横跨性，这样就可以让同样的代码既能在SAE下运行，也能在普通环境下运行， 使你在本地调试完后上传到SAE也不用修改任何代码就能运行。<br />下面是一些保持代码横跨性的建议：<br />（1）尽量少使用原生的SAE服务
  能使用ThinkPHP自带函数替代的，尽量使用ThinkPHP自带函数。比如要使用SAE的KVDB服务，在ThinkPHP中完全可以用F函数代替。如果要使用SAE的Memcache服务，都使用S函数实现。 这样就不会导致你的代码从SAE转移到普通环境后性能很低。
  个别SAE服务无法使用ThinkPHP自带函数代替的，才考虑使用原生的SAE服务。<br />（2）利用IS_SAE常量<br />ThinkPHP的SAE引擎增加了IS_SAE常量，能判断代码运行环境是普通环境还是SAE环境。如果你有段代码在普通环境和在SAE环境下实现方式不同，你可以使用IS_SAE进行判断后做不同处理或者加载不同的文件。<br />（3）利用SAE专有文件
  在SAE惯例配置中，我们可以看见除了配置了固定的数据库配置项，还有一个SAE_SPECIALIZED_FILES配置项，它定义了系统专有文件。目前已经定义了UploadFile类和Image类的SAE专有文件，所以当我们的代码 import(“@.ORG.UploadFile”) 在本地运行时会按普通方式导入项目下Lib/ORG/UploadFile.class.php文件， 而在SAE上运行是系统检查到UploadFile.class.php有SAE专有文件，它导入的是SAE_SPECIALIZED_FILES配置项中定义的文件地址。这样实现了普通环境和SAE环境下同样的代码导入了不同类库，而类的调用方法都是一样的，只是现实方法不同，这样就能保证了代码的横跨性。<br />你也可以自己建立SAE专有文件，你可以将专有文件放在和普通文件同级目录，这样不用定义SAE_SPECIALIZED_FILE配置项，系统也能识别专有文件。比如我们在Image.class.php的文件的同级目录如果定义了一个名为Image_sae.class.php 的文件，则系统SAE上运行时，导入Image.class.php文件时会改为导入Image_sae.class.php文件。
 如果一个类库既定义了同级目录下的专有文件，也在SAE_SPECIALIZED_FILE配置项中有定义，则会优先导入同级目录下的专有文件。建议大家如果需要建立专有文件时，在普通文件同级目录下建立。<br />如果导入的类库没有SAE专有文件，在SAE下运行时也会导入普通文件。<br />我们可以利用SAE专有文件，针对普通环境和SAE环境封装不同的类库，但类库的使用方法都是相同的，从而让类库的客户端代码具有横跨性。<br />（4）利用SAE专有配置
  当遇到SAE和普通环境配置需要不一样时，你可以把普通环境的配置写到项目配置文件Conf/config.php中，而 将SAE需要用的配置写到SAE专有配置Conf/config_sae.php中。</div></div></div><script type="text/javascript">remark();</script><div id="footer" class="book-footer"><p>&copy;2012 ThinkPHP文档中心 由<a target="_blank" href="http://www.thinkphp.cn">&nbsp;</a>强力驱动</p><script type="text/javascript" src="http://tajs.qq.com/stats?sId=8891584" charset="UTF-8"></script></div></body></html>
<!-- Localized -->